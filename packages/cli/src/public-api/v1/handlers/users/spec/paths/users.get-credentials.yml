get:
  x-eov-operation-id: getUserCredentials
  x-eov-operation-handler: v1/handlers/users/users.handler.ee
  tags:
    - User
  summary: Get user credentials by email or ID
  description: |
    Retrieve the latest non-expired API key for a user.

    **Lookup Methods:**
    - `id` (preferred): Faster, more stable
    - `email`: Will be deprecated in future versions

    Provide EITHER `id` OR `email` (not both).

    **SECURITY WARNING**: Returns FULL unredacted API key.
    - Should only be used in secure, server-to-server contexts
    - All access is logged for audit purposes
    - Requires 'user:read' scope

    Returns 404 if:
    - User does not exist
    - User has no API keys
    - All API keys are expired
  parameters:
    - name: email
      in: query
      required: false
      schema:
        type: string
        format: email
      example: user@example.com
      description: Email address of the user (legacy method)
    - name: id
      in: query
      required: false
      schema:
        type: string
        format: uuid
      example: 9c4f3c8f-e928-4d38-a0cc-61b8b0c6f9de
      description: UUID of the user (preferred method)
  responses:
    '200':
      description: User credentials retrieved successfully
      content:
        application/json:
          schema:
            type: object
            properties:
              user_id:
                type: string
                example: '9c4f3c8f-e928-4d38-a0cc-61b8b0c6f9de'
              email:
                type: string
                example: user@example.com
              api_key:
                type: string
                example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
                description: FULL unredacted JWT API key
              label:
                type: string
                example: 'Brackett API Key'
              expires_at:
                type: number
                nullable: true
                example: 1735689600
                description: Unix timestamp (null = never expires)
              created_at:
                type: string
                format: date-time
                example: '2025-10-25T14:30:00.000Z'
    '400':
      description: Bad request - Neither email nor id provided, or invalid format
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: Either email or id must be provided
    '404':
      description: User not found, no API keys, or all keys expired
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: User with id 9c4f3c8f-e928-4d38-a0cc-61b8b0c6f9de not found
    '401':
      $ref: '../../../../shared/spec/responses/unauthorized.yml'
    '403':
      $ref: '../../../../shared/spec/responses/forbidden.yml'
